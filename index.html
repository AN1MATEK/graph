<!DOCTYPE html>
<html>
<head>
	<meta name="description" content="Tracker Map" />
	<meta charset=utf-8 />
	<meta name="viewport" content="user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, minimal-ui">
	<title>Tracker Map</title>
	<style>
	html, body { 
		font: 16px sans-serif;
		color: #fff;
		width: 100%;
		height: 100%;
		margin: 0;
		padding: 0;
	}

	#cy {
		position: absolute;
		left: 0;
		top: 0;
		right: 0;
		bottom: 0;
		background: #000;
	}
	#options {
		position: absolute;
		top: 0.5em;
		right: 0.5em;
	}
	#pathfind {
		position: absolute;
		top: 0.5em;
		left: 0.5em;
	}
	</style>
</head>
<body>
	<div id="cy"></div>
	<div id="options">
		<input type="checkbox" id="abbrev" checked />
		<label for="abbrev">Abbreviate tracker names</label>

		<input type="checkbox" id="nodeadends" checked />
		<label for="nodeadends">Remove dead ends</label>

		<button id="relayout">Refresh layout</button>
	</div>
	<div id="pathfind">
		<div>
			Source: <select id="source-select"></select>
			Target: <select id="target-select"></select>
		</div>

		<input type="checkbox" id="pathonly" />
		<label for="pathonly">Hide elements not on path</label>
	</div>
	<div style="position:absolute;bottom:0.5em;left:0.5em;">
		Click on circles and arrows to get additional information.<br>
		Create issues on the <a href="https://github.com/inviteroute/graph">GitHub repository</a> to contribute data.
	</div>

	<script src="https://unpkg.com/cytoscape@3.23.0/dist/cytoscape.min.js"></script>
	<script src="https://unpkg.com/@popperjs/core@2"></script>
	<script src="https://unpkg.com/cytoscape-popper@2.0.0/cytoscape-popper.js"></script>
	<script src="https://unpkg.com/tippy.js@6"></script>
	<script src="https://unpkg.com/cytoscape-euler@1.2.2"></script>
	<script type="text/javascript">
	const cy = cytoscape({
		container: document.getElementById("cy"),
		elements: [
{data:{id:"AB",name:"AnimeBytes",info:"No additional information."}},{data:{id:"ABT",name:"ABTorrents",info:"No additional information."}},{data:{id:"Aither",name:"Aither",info:"No additional information."}},{data:{id:"ANT",name:"Anthelion",info:"No additional information."}},{data:{id:"BdC",name:"BroadCity",info:"No additional information."}},{data:{id:"BHD",name:"BeyondHD",info:"No additional information."}},{data:{id:"BLU",name:"Blutopia",info:"No additional information."}},{data:{id:"BtW",name:"BreatheTheWord",info:"No additional information."}},{data:{id:"BRKS",name:"BrokenStones",info:"No additional information."}},{data:{id:"CCS",name:"Concertos",info:"No additional information."}},{data:{id:"CGP",name:"CGPeers",info:"No additional information."}},{data:{id:"D3Si",name:"D3Si",info:"No additional information."}},{data:{id:"DIC",name:"Dolphin Is Coming",info:"No additional information."}},{data:{id:"EB",name:"ExtremeBits",info:"No additional information."}},{data:{id:"Emp",name:"Empornium",info:"No additional information."}},{data:{id:"FF",name:"FunFile",info:"No additional information."}},{data:{id:"GGn",name:"GazelleGames.net",info:"Invite forum unlocks with Pro Gamer user class. All user classes are gained with achievement points."}},{data:{id:"GPW",name:"GreatPosterWall",info:"No additional information."}},{data:{id:"LB",name:"LearnBits",info:"No additional information."}},{data:{id:"LzTr",name:"LzTr",info:"No additional information."}},{data:{id:"MAM",name:"MyAnonaMouse",info:"Invite forum unlocks with Power User user class: 25GB upload, 2.0 ratio, 4 weeks account age."}},{data:{id:"Milkie",name:"Milkie",info:"No additional information."}},{data:{id:"MTV",name:"MoreThanTV",info:"No additional information."}},{data:{id:"MyXZ",name:"XtremeZone",info:"No additional information."}},{data:{id:"NBL",name:"Nebulance",info:"No additional information."}},{data:{id:"OBS",name:"Obscure",info:"No additional information."}},{data:{id:"OpenCD",name:"Open.CD",info:"No additional information."}},{data:{id:"OPS",name:"Orpheus",info:"Invite forum unlocks with Elite user class: 100GB upload, 1.05 ratio, 50 torrents uploaded, 4 weeks accout age."}},{data:{id:"OTW",name:"OldToons.world",info:"No additional information."}},{data:{id:"PB",name:"Pornbay",info:"No additional information."}},{data:{id:"PTer",name:"PTerClub",info:"No additional information."}},{data:{id:"PTN",name:"PirateTheNet",info:"No additional information."}},{data:{id:"PTP",name:"PassThePopcorn",info:"No additional information."}},{data:{id:"PxC",name:"PixelCove",info:"No additional information."}},{data:{id:"PxHD",name:"PixelHD",info:"No additional information."}},{data:{id:"RED",name:"Redacted",info:"Invite forum unlocks with Power User user class: 25GB upload, 0.65 ratio, 5 torrents uploaded, 2 weeks accout age.<br/><br/>Elite user class: 100GB upload, 0.65 ratio, 50 torrents uploaded, 4 weeks accout age.<br/>Torrent Master user class: 500GB upload, 0.65 ratio, 500 torrents uploaded, 8 weeks accout age."}},{data:{id:"RTT",name:"RevolutionTT",info:"No additional information."}},{data:{id:"SC",name:"Secret Cinema",info:"No additional information."}},{data:{id:"SM",name:"SugoiMusic",info:"No additional information."}},{data:{id:"SHD",name:"SceneHD",info:"No additional information."}},{data:{id:"TG",name:"TheGeeks.click",info:"No additional information."}},{data:{id:"TLFB",name:"TLFBits",info:"No additional information."}},{data:{id:"TSP",name:"TheScenePlace",info:"No additional information."}},{data:{id:"SG",name:"SocietyGlitch",info:"No additional information."}},{data:{id:"UHDB",name:"UHDBits",info:"No additional information."}},{data:{source:"GGn",target:"AB",info:"No additional information."}},{data:{source:"GGn",target:"ANT",info:"No additional information."}},{data:{source:"GGn",target:"CGP",info:"No additional information."}},{data:{source:"GGn",target:"CCS",info:"No additional information."}},{data:{source:"GGn",target:"DIC",info:"No additional information."}},{data:{source:"GGn",target:"Emp",info:"No additional information."}},{data:{source:"GGn",target:"EB",info:"No additional information."}},{data:{source:"GGn",target:"FF",info:"No additional information."}},{data:{source:"GGn",target:"MAM",info:"No additional information."}},{data:{source:"GGn",target:"MTV",info:"No additional information."}},{data:{source:"GGn",target:"NBL",info:"No additional information."}},{data:{source:"GGn",target:"OpenCD",info:"No additional information."}},{data:{source:"GGn",target:"OPS",info:"No additional information."}},{data:{source:"GGn",target:"PB",info:"No additional information."}},{data:{source:"GGn",target:"PTer",info:"No additional information."}},{data:{source:"GGn",target:"PTN",info:"No additional information."}},{data:{source:"GGn",target:"PxC",info:"No additional information."}},{data:{source:"GGn",target:"PxHD",info:"No additional information."}},{data:{source:"GGn",target:"RED",info:"No additional information."}},{data:{source:"GGn",target:"SG",info:"No additional information."}},{data:{source:"GGn",target:"UHDB",info:"No additional information."}},{data:{source:"MAM",target:"ABT",info:"No additional information."}},{data:{source:"MAM",target:"Aither",info:"No additional information."}},{data:{source:"MAM",target:"ANT",info:"No additional information."}},{data:{source:"MAM",target:"BdC",info:"2 months account age."}},{data:{source:"MAM",target:"BtW",info:"No additional information."}},{data:{source:"MAM",target:"BRKS",info:"1.51 ratio. 1 year account age."}},{data:{source:"MAM",target:"CGP",info:"1TB upload. 6 months account age."}},{data:{source:"MAM",target:"Milkie",info:"No additional information."}},{data:{source:"MAM",target:"MyXZ",info:"1 other tracker profile with 1 year account age."}},{data:{source:"MAM",target:"NBL",info:"No additional information."}},{data:{source:"MAM",target:"OBS",info:"100GB upload. 3 months account age."}},{data:{source:"MAM",target:"OPS",info:"No additional information."}},{data:{source:"MAM",target:"OTW",info:"No additional information."}},{data:{source:"MAM",target:"PxC",info:"No additional information."}},{data:{source:"MAM",target:"PxHD",info:"2 other tracker profiles. 6 months account age."}},{data:{source:"MAM",target:"SC",info:"50GB upload. 6 months account age."}},{data:{source:"MAM",target:"SM",info:"No additional information."}},{data:{source:"MAM",target:"TG",info:"2 or 3 other tracker profiles."}},{data:{source:"MAM",target:"TSP",info:"2.0 ratio. 2 months account age."}},{data:{source:"OPS",target:"ANT",info:"No additional information."}},{data:{source:"OPS",target:"BRKS",info:"1.51 ratio. 1 year account age."}},{data:{source:"OPS",target:"CCS",info:"No additional information."}},{data:{source:"OPS",target:"GGn",info:"3 months account age."}},{data:{source:"OPS",target:"LzTr",info:"6 months account age."}},{data:{source:"OPS",target:"MTV",info:"1.5 ratio. 6 months account age."}},{data:{source:"OPS",target:"NBL",info:"No additional information."}},{data:{source:"OPS",target:"OpenCD",info:"No additional information."}},{data:{source:"OPS",target:"RED",info:"3 months account age."}},{data:{source:"OPS",target:"SM",info:"No additional information."}},{data:{source:"OPS",target:"UHDB",info:"No additional information."}},{data:{source:"RED",target:"AB",info:"1 year account age."}},{data:{source:"RED",target:"ANT",info:"No additional information."}},{data:{source:"RED",target:"BHD",info:"Elite user class."}},{data:{source:"RED",target:"BLU",info:"No additional information."}},{data:{source:"RED",target:"BdC",info:"4 months account age."}},{data:{source:"RED",target:"BRKS",info:"Elite user class. 1.51 ratio. 1 year account age."}},{data:{source:"RED",target:"CGP",info:"1.0 ratio. 6 months account age."}},{data:{source:"RED",target:"CCS",info:"No additional information."}},{data:{source:"RED",target:"D3Si",info:"Elite user class. 1.5 ratio. 100 Perfect FLAC torrent uploads. 1 year account age"}},{data:{source:"RED",target:"DIC",info:"10 music torrent uploads."}},{data:{source:"RED",target:"Emp",info:"6 months account age."}},{data:{source:"RED",target:"GGn",info:"3 months account age."}},{data:{source:"RED",target:"GPW",info:"4 weeks account age."}},{data:{source:"RED",target:"LB",info:"1 other tracker profile."}},{data:{source:"RED",target:"MAM",info:"No additional information."}},{data:{source:"RED",target:"MTV",info:"6 months account age."}},{data:{source:"RED",target:"NBL",info:"No additional information."}},{data:{source:"RED",target:"OPS",info:"No additional information."}},{data:{source:"RED",target:"PTN",info:"No additional information."}},{data:{source:"RED",target:"PTP",info:"Torrent Master user class. 1 year account age."}},{data:{source:"RED",target:"PxHD",info:"No additional information."}},{data:{source:"RED",target:"RTT",info:"No additional information."}},{data:{source:"RED",target:"SC",info:"No additional information."}},{data:{source:"RED",target:"SM",info:"No additional information."}},{data:{source:"RED",target:"SHD",info:"No additional information."}},{data:{source:"RED",target:"TLFB",info:"No additional information."}},{data:{source:"RED",target:"TG",info:"No additional information."}},{data:{source:"RED",target:"TSP",info:"No additional information."}},{data:{source:"RED",target:"UHDB",info:"No additional information."}}],
		style: [ {
			selector: "node",
			style: {
				"background-color": "#6a6",
				"label": "data(id)",
				"color": "#0f0" } }, {
			selector: "node[deadend]",
			style: {
				"background-color": "#a66",
				"color": "#f00" } }, {
			selector: "node[?path]",
			style: {
				"background-color": "#6aa",
				"color": "#0ff" } }, {
			selector: "edge",
			style: {
				"width": 3,
				"line-color": "#666",
				"target-arrow-color": "#666",
				"target-arrow-shape": "triangle",
				"curve-style": "bezier" } }
		]
	});

	// Options: Abbreviate tracker names
	const abbrev = document.getElementById("abbrev");
	const updateAbbrev = () => {
		cy.style()
			.selector("node")
			.style({
				"label": abbrev.checked ? "data(id)" : "data(name)",
			})
			.update();
	};
	abbrev.addEventListener("change", updateAbbrev);
	updateAbbrev();

	// Options: Remove dead ends
	cy.batch(() => {
		cy.nodes().leaves().forEach(n => n.data("deadend", true));
	});

	const nodeadends = document.getElementById("nodeadends");
	const updateDeadends = () => {
		cy.style()
			.selector("node[deadend][!path]")
			.style({
				"display": nodeadends.checked ? "none" : "element",
			})
			.update();
	};

	updateDeadends();
	nodeadends.addEventListener("change", updateDeadends);

	// Layout
	const layout = {
		name: "euler",
		animate: false,
		randomize: true,
		springLength: (edge) => 15*(4 + edge.target().connectedEdges().length),
		nodeDimensionsIncludeLabels: true,
	};

	document.getElementById("relayout").addEventListener("click", () => {
		cy.layout(layout).run();
	});
	cy.layout(layout).run();

	// Additional route info
	let shownTippy;

	function makeTippy(node, content) {
		removeTippy();

		let ref = node.popperRef();
		let dummy = document.createElement("div");

		shownTippy = tippy(dummy, {
			getReferenceClientRect: ref.getBoundingClientRect,
			appendTo: document.body,
			trigger: "manual",

			arrow: true,
			placement: "bottom",
			hideOnClick: false,
			duration: [250, 0],
			sticky: "reference",
			theme: "light",
			interactive: true,

			content: content,
			allowHTML: true,

			onHidden: function(tip) {
				if (tip != null) {
					tip.destroy();
				}
			}
		});

		shownTippy.show();

		return shownTippy;
	}

	function removeTippy() {
		if (shownTippy) {
			shownTippy.hide();
		}
	}

	cy.on("tap", (evt) => {
		let tgt = evt.target;
		if (tgt.isEdge && tgt.isEdge()) {
			const data = tgt.data();
			makeTippy(tgt, data.source + " → " + data.target + ": " + data.info);
		} else if (tgt.isNode && tgt.isNode()) {
			const data = tgt.data();
			makeTippy(tgt, data.id + " (" + data.name + ")<br/>" + data.info);
		} else {
			removeTippy();
		}
	});

	// Pathfinding
	const sourceSelect = document.getElementById("source-select");
	const targetSelect = document.getElementById("target-select");

	const pathfind = () => {
		let res = cy.elements().aStar({
			root: cy.$id(sourceSelect.value),
			goal: cy.$id(targetSelect.value),
			directed: true
		});

		if (!res.found) {
			shownTippy = tippy("#pathfind", {
				trigger: "manual",
				arrow: true,
				placement: "bottom",
				hideOnClick: false,
				duration: [250, 0],
				sticky: "reference",
				theme: "light",
				interactive: true,

				content: "No path found.",

				onHidden: function(tip) {
					if (tip != null) {
						tip.destroy();
					}
				}
			})[0];
			shownTippy.show();
			return;
		}

		cy.batch(() => {
			cy.elements().forEach(n => n.data("path", false));
			res.path.forEach(n => n.data("path", true));
		});
	};

	const setupPathfindSelect = (select) => {
		cy.nodes().forEach(node => {
			select.add(new Option(node.id() + ": " + node.data().name, node.id()));
		});

		select.addEventListener("change", pathfind);
	};

	setupPathfindSelect(sourceSelect);
	setupPathfindSelect(targetSelect);
	sourceSelect.value = "RED";
	targetSelect.value = "RED";
	pathfind();

	const pathonly = document.getElementById("pathonly");
	pathonly.addEventListener("change", () => {
		cy.style()
			.selector("[!path]")
			.style({
				"display": pathonly.checked ? "none" : "element",
			})
			.update();
	});
	</script>
</body>
</html>